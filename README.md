# Cracker

This is a lifestyle/productivity intelligence app for tracking and analyzing creative work

## Requirements

- [Node.js](#nodejs)
- [MySQL](#mysql)
- [Redis](#redis)

## Development

Start setting up your dev environment by running the three separate services

### [Redis](https://redis.io/)

- The easy one. Start the service and confirm it is running. No config required
- Note the port it's running on and add it to your .env file (ie. REDIS_URL="localhost:6379")

### [MySQL](https://www.mysql.com/)

- Start the service and create a new database
- Note the database credentials and fill them into the connection string in your .env file (DATABASE_URL)
  - In production, you may want to use [Prisma Accelerate](https://www.prisma.io/docs/accelerate), which is why the example .env file includes both DATABASE_URL and DIRECT_URL, with DATABASE_URL pointing to an Accelerate URI (prisma://...)
    - If not, you can remove the Accelerate-specific code in prisma.ts and update your schema to use only DATABASE_URL. Just remember to regenerate Prisma Client when making changes like that
  - For local development, point both variables to the same local connection string (mysql://...)
- Run the migrations with `npx prisma migrate reset`
  - This creates 7 tables and several other resources in the new database
  - You can check it against the [baseline migration](prisma/migrations/0_init/migration.sql)
  - See [Database](#database) below for verbose DB documentation
- If you prefer to use [Docker](https://www.docker.com/), there are some SQL scripts, [Dockerfiles](https://docs.docker.com/build/concepts/dockerfile/), and [Docker Compose](https://docs.docker.com/compose/intro/compose-application-model/) projects in the [server](/server/) directory
  - The SQL scripts are prefixed with numbers to properly enforce an order of operations when building the Docker image
  - The compose projects aren't currently functional due to a lack of use. The structure is correct, but some debugging is required. If you get it working, please [issue a pull request](https://github.com/spope851/cracker/pulls)
  - There are scripts for [PostgreSQL](https://www.postgresql.org/) included as well. The app will work with Postgres, but you will have to tweak the [prisma schema](prisma/schema.prisma) if you choose to use it
  - Be sure to [baseline your database](https://www.prisma.io/docs/getting-started/setup-prisma/add-to-existing-project/relational-databases/baseline-your-database-typescript-postgresql) after building the Docker image so that you can generate Prisma Client properly

### [Node.js](https://nodejs.org/en)

We recommend [Yarn](https://classic.yarnpkg.com/en/) for package management. Install it with `npm i -g yarn`

- Install dependencies with `yarn`
- Generate [Prisma Client](https://www.prisma.io/docs/orm/prisma-client/setup-and-configuration/introduction) with `yarn postinstall`
- Start the dev at [localhost:3000](http://localhost:3000) with `yarn dev`

## Environment

Start your .env file by running `cp .env.example .env`

- Fill in the connection strings you took note of for Redis and MySQL
- Run `npx auth secret` and copy the secret from the .env.local file generated by the command into your .env file (or, stick with the .env.local file. just make sure all variables in [.env.example](.env.example) are set)
  - Note: we're not using the latest version of [auth.js](https://authjs.dev). Set the variable name to NEXTAUTH_SECRET
- We use a [WordPress](https://wordpress.org) website to publish content about Cracker. This app accesses that content via REST API using the WP_ROOT env variable. If you want to set up a WordPress site [like this one](https://blog.cracker.my.id) for that purpose, add the site URL (including protocol) to that variable. Otherwise, remove it and any code referring to it. It is separate from the app's core functionality. 

## Database
...